<!DOCTYPE html>
<html lang="tr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Diyet Takip Sistemi</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Manrope:wght@400;600;800&display=swap');

        :root {
            --primary: #FF6B35;
            --secondary: #F7931E;
            --success: #4CAF50;
            --warning: #FFB800;
            --danger: #E74C3C;
            --dark: #2C3E50;
            --light: #ECF0F1;
            --white: #FFFFFF;
            --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            --shadow-hover: 0 15px 40px rgba(0, 0, 0, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Manrope', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1440 320"><path fill="%23ffffff" fill-opacity="0.05" d="M0,96L48,112C96,128,192,160,288,160C384,160,480,128,576,122.7C672,117,768,139,864,154.7C960,171,1056,181,1152,165.3C1248,149,1344,107,1392,85.3L1440,64L1440,320L1392,320C1344,320,1248,320,1152,320C1056,320,960,320,864,320C768,320,672,320,576,320C480,320,384,320,288,320C192,320,96,320,48,320L0,320Z"></path></svg>') no-repeat bottom;
            background-size: cover;
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        header {
            text-align: center;
            margin-bottom: 50px;
            animation: slideDown 0.8s ease;
        }

        h1 {
            font-family: 'Bebas Neue', cursive;
            font-size: 4rem;
            color: white;
            text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.2);
            letter-spacing: 3px;
            margin-bottom: 10px;
            position: relative;
            display: inline-block;
        }

        h1::after {
            content: 'ü•ó';
            position: absolute;
            right: -60px;
            top: 0;
            font-size: 3rem;
            animation: bounce 2s infinite;
        }

        .subtitle {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.2rem;
            font-weight: 600;
        }

        .stats-bar {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            animation: slideUp 0.8s ease 0.2s both;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }

        .stat-item {
            text-align: center;
            padding: 15px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
            transition: transform 0.3s ease;
        }

        .stat-item:hover {
            transform: translateY(-5px);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            display: block;
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        .food-groups {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 30px;
        }

        .food-group {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
            animation: slideUp 0.8s ease both;
            animation-delay: calc(var(--delay) * 0.1s);
        }

        .food-group::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 5px;
            background: linear-gradient(90deg, var(--group-color) 0%, transparent 100%);
        }

        .food-group:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .group-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
        }

        .group-icon {
            font-size: 2.5rem;
            margin-right: 15px;
        }

        .group-title {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--dark);
            flex: 1;
        }

        .group-status {
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            color: white;
            background: var(--warning);
            transition: all 0.3s ease;
        }

        .group-status.complete {
            background: var(--success);
        }

        .group-status.exceed {
            background: var(--danger);
            animation: pulse 1.5s infinite;
        }

        .portion-info {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            padding: 10px;
            background: rgba(0, 0, 0, 0.03);
            border-radius: 10px;
        }

        .portion-text {
            font-size: 1rem;
            color: var(--dark);
            font-weight: 600;
        }

        .portion-count {
            font-size: 1.2rem;
            font-weight: 800;
            color: var(--primary);
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: var(--light);
            border-radius: 10px;
            overflow: hidden;
            margin-bottom: 15px;
            position: relative;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--group-color) 0%, var(--group-color-light) 100%);
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            bottom: 0;
            right: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shimmer 2s infinite;
        }

        .food-items {
            max-height: 300px;
            overflow-y: auto;
            padding-right: 10px;
        }

        .food-items::-webkit-scrollbar {
            width: 6px;
        }

        .food-items::-webkit-scrollbar-track {
            background: var(--light);
            border-radius: 10px;
        }

        .food-items::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 10px;
        }

        .food-item {
            display: flex;
            align-items: center;
            padding: 12px;
            margin-bottom: 10px;
            background: rgba(0, 0, 0, 0.02);
            border-radius: 12px;
            transition: all 0.3s ease;
            position: relative;
        }

        .food-item:hover {
            background: rgba(0, 0, 0, 0.05);
        }

        .food-item.selected {
            background: linear-gradient(135deg, rgba(102, 126, 234, 0.1) 0%, rgba(118, 75, 162, 0.1) 100%);
            border-left: 3px solid var(--success);
        }

        .food-checkbox {
            width: 20px;
            height: 20px;
            margin-right: 15px;
            accent-color: var(--primary);
            cursor: pointer;
        }

        .food-name {
            flex: 1;
            font-weight: 600;
            color: var(--dark);
        }

        .food-amount {
            color: #666;
            font-size: 0.9rem;
            margin: 0 15px;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            border-radius: 8px;
            padding: 4px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .quantity-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: var(--primary);
            color: white;
            border-radius: 6px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .quantity-btn:hover {
            background: var(--secondary);
            transform: scale(1.1);
        }

        .quantity-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: scale(1);
        }

        .quantity-value {
            min-width: 30px;
            text-align: center;
            font-weight: 800;
            font-size: 1.1rem;
            color: var(--dark);
        }

        .reset-button {
            background: var(--danger);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 30px;
            font-size: 1.1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
            display: block;
            margin: 30px auto;
        }

        .reset-button:hover {
            transform: translateY(-3px);
            box-shadow: var(--shadow-hover);
        }

        .complex-foods-section {
            margin-top: 40px;
            margin-bottom: 30px;
        }

        .complex-foods-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .complex-foods-header h2 {
            font-family: 'Bebas Neue', cursive;
            font-size: 2.5rem;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
        }

        .complex-foods-info {
            color: rgba(255, 255, 255, 0.9);
            font-size: 1rem;
        }

        .complex-foods-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .complex-food-item {
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: var(--shadow);
            transition: all 0.3s ease;
            cursor: pointer;
            border-left: 5px solid var(--primary);
        }

        .complex-food-item:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-hover);
        }

        .complex-food-item.selected {
            background: linear-gradient(135deg, rgba(255, 107, 53, 0.1) 0%, rgba(247, 147, 30, 0.1) 100%);
            border-left-color: var(--success);
        }

        .complex-food-header-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 15px;
            gap: 10px;
        }

        .complex-food-header-row .food-checkbox {
            flex-shrink: 0;
        }

        .complex-food-name {
            font-weight: 800;
            color: var(--dark);
            font-size: 1.1rem;
            flex: 1;
        }

        .complex-food-portion {
            color: #666;
            font-size: 0.9rem;
            background: rgba(0, 0, 0, 0.05);
            padding: 5px 10px;
            border-radius: 10px;
        }

        .complex-food-exchanges {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }

        .exchange-badge {
            background: linear-gradient(135deg, var(--badge-color) 0%, var(--badge-color-light) 100%);
            color: white;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .exchange-count {
            background: rgba(255, 255, 255, 0.3);
            padding: 2px 6px;
            border-radius: 5px;
            font-weight: 800;
        }

        .date-selector {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 15px;
            animation: slideUp 0.8s ease 0.1s both;
        }

        .date-display {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .date-label {
            font-weight: 600;
            color: var(--dark);
            font-size: 1.1rem;
        }

        .current-date {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 15px;
            font-weight: 800;
            font-size: 1.2rem;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
        }

        .date-nav {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .date-nav-btn {
            background: var(--primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            font-size: 1.3rem;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .date-nav-btn:hover {
            background: var(--secondary);
            transform: scale(1.1);
        }

        .date-nav-btn.today {
            background: var(--success);
            padding: 0 15px;
            width: auto;
            border-radius: 20px;
            font-size: 1rem;
            font-weight: 600;
        }

        .history-section {
            margin-top: 40px;
            margin-bottom: 30px;
        }

        .history-header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .history-header h2 {
            font-family: 'Bebas Neue', cursive;
            font-size: 2.5rem;
            letter-spacing: 2px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 10px;
        }

        .history-container {
            background: white;
            border-radius: 20px;
            padding: 25px;
            box-shadow: var(--shadow);
            overflow-x: auto;
        }

        .history-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .history-table th {
            background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
            color: white;
            padding: 15px 10px;
            text-align: center;
            font-weight: 800;
            font-size: 0.95rem;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .history-table th:first-child {
            border-radius: 10px 0 0 0;
            text-align: left;
            padding-left: 20px;
        }

        .history-table th:last-child {
            border-radius: 0 10px 0 0;
        }

        .history-table td {
            padding: 12px 10px;
            text-align: center;
            border-bottom: 1px solid rgba(0, 0, 0, 0.05);
        }

        .history-table td:first-child {
            text-align: left;
            padding-left: 20px;
            font-weight: 600;
            color: var(--dark);
        }

        .history-table tbody tr:hover {
            background: rgba(0, 0, 0, 0.02);
        }

        .history-table tbody tr.today-row {
            background: linear-gradient(90deg, rgba(76, 175, 80, 0.1) 0%, transparent 100%);
            font-weight: 600;
        }

        .progress-cell {
            position: relative;
        }

        .progress-mini {
            width: 100%;
            height: 20px;
            background: var(--light);
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .progress-mini-fill {
            height: 100%;
            border-radius: 10px;
            transition: width 0.5s ease;
            position: relative;
            overflow: hidden;
        }

        .progress-mini-fill.complete {
            background: linear-gradient(90deg, #4CAF50 0%, #45a049 100%);
        }

        .progress-mini-fill.partial {
            background: linear-gradient(90deg, #FFB800 0%, #FFA000 100%);
        }

        .progress-mini-fill.exceed {
            background: linear-gradient(90deg, #E74C3C 0%, #c0392b 100%);
        }

        .progress-mini-text {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: var(--dark);
            font-weight: 700;
            font-size: 0.85rem;
            text-shadow: 0 0 2px rgba(255, 255, 255, 0.8);
            z-index: 1;
        }

        .total-score {
            font-weight: 800;
            font-size: 1.1rem;
            padding: 5px 10px;
            border-radius: 10px;
            color: white;
        }

        .total-score.perfect {
            background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%);
        }

        .total-score.good {
            background: linear-gradient(135deg, #FFB800 0%, #FFA000 100%);
        }

        .total-score.low {
            background: linear-gradient(135deg, #E74C3C 0%, #c0392b 100%);
        }

        .no-history {
            text-align: center;
            padding: 40px;
            color: #999;
            font-size: 1.1rem;
        }

        .history-controls {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .history-range-selector {
            display: flex;
            gap: 10px;
        }

        .range-btn {
            padding: 8px 16px;
            border: 2px solid var(--primary);
            background: white;
            color: var(--primary);
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }

        .range-btn:hover,
        .range-btn.active {
            background: var(--primary);
            color: white;
        }

        .export-btn {
            background: linear-gradient(135deg, #27ae60 0%, #229954 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 10px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .export-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            border-radius: 10px;
            color: white;
            font-weight: 600;
            transform: translateX(400px);
            transition: transform 0.5s ease;
            z-index: 1000;
            box-shadow: var(--shadow);
        }

        .notification.show {
            transform: translateX(0);
        }

        .notification.success {
            background: var(--success);
        }

        .notification.warning {
            background: var(--warning);
        }

        .notification.error {
            background: var(--danger);
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(50px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes bounce {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-10px);
            }
        }

        @keyframes pulse {

            0%,
            100% {
                opacity: 1;
            }

            50% {
                opacity: 0.7;
            }
        }

        @keyframes shimmer {
            0% {
                transform: translateX(-100%);
            }

            100% {
                transform: translateX(200%);
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2.5rem;
            }

            .food-groups {
                grid-template-columns: 1fr;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>Dƒ∞YET TAKƒ∞P Sƒ∞STEMƒ∞</h1>
            <p class="subtitle">G√ºnl√ºk besin takibinizi kolayla≈ütƒ±rƒ±n</p>
        </header>

        <div class="date-selector">
            <div class="date-display">
                <span class="date-label">Tarih:</span>
                <span class="current-date" id="currentDate">Bug√ºn</span>
            </div>
            <div class="date-nav">
                <button class="date-nav-btn" onclick="changeDate(-1)">‚óÑ</button>
                <button class="date-nav-btn today" onclick="goToToday()">Bug√ºn</button>
                <button class="date-nav-btn" onclick="changeDate(1)">‚ñ∫</button>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stats-grid">
                <div class="stat-item">
                    <span class="stat-value" id="totalPortions">0</span>
                    <span class="stat-label">T√ºketilen Porsiyon</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="completedGroups">0</span>
                    <span class="stat-label">Tamamlanan Grup</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="remainingPortions">0</span>
                    <span class="stat-label">Kalan Porsiyon</span>
                </div>
                <div class="stat-item">
                    <span class="stat-value" id="progressPercent">0%</span>
                    <span class="stat-label">G√ºnl√ºk ƒ∞lerleme</span>
                </div>
            </div>
        </div>

        <div class="food-groups" id="foodGroups">
            <!-- Food groups will be dynamically inserted here -->
        </div>

        <div class="complex-foods-section">
            <div class="complex-foods-header">
                <h2>üçΩÔ∏è KOMPLƒ∞KE Yƒ∞YECEKLER</h2>
                <p class="complex-foods-info">Bu yiyecekler birden fazla besin grubundan deƒüi≈üim i√ßerir</p>
            </div>
            <div class="complex-foods-grid" id="complexFoods">
                <!-- Complex foods will be dynamically inserted here -->
            </div>
        </div>

        <button class="reset-button" onclick="resetDaily()">üîÑ G√ºnl√ºk Sƒ±fƒ±rla</button>

        <div class="history-section">
            <div class="history-header">
                <h2>üìÖ GE√áMƒ∞≈û TAKƒ∞P</h2>
                <p class="complex-foods-info">Son 30 g√ºnl√ºk diyet takip ge√ßmi≈üiniz</p>
            </div>
            <div class="history-container">
                <div class="history-controls">
                    <div class="history-range-selector">
                        <button class="range-btn active" onclick="changeHistoryRange(7)">7 G√ºn</button>
                        <button class="range-btn" onclick="changeHistoryRange(14)">14 G√ºn</button>
                        <button class="range-btn" onclick="changeHistoryRange(30)">30 G√ºn</button>
                    </div>
                    <button class="export-btn" onclick="exportHistory()">
                        üìä Excel'e Aktar
                    </button>
                </div>
                <div id="historyTableContainer">
                    <!-- History table will be inserted here -->
                </div>
            </div>
        </div>
    </div>

    <div class="notification" id="notification"></div>

    <script>
        // Besin gruplarƒ± ve hedef porsiyonlar
        const foodGroups = {
            'S√úT': {
                target: 3,
                icon: 'ü•õ',
                color: '#3498db',
                colorLight: '#5dade2',
                items: [
                    { name: 'S√ºt, yoƒüurt (tam yaƒülƒ±)', amount: '1 k√º√ß√ºk su bardaƒüƒ± (160 gr)' },
                    { name: 'S√ºt, yoƒüurt (yarƒ±m yaƒülƒ±)', amount: '1 su bardaƒüƒ± (200 gr)' },
                    { name: 'S√ºt, yoƒüurt (yaƒüsƒ±z)', amount: '1,5 su bardaƒüƒ± (300 gr)' },
                    { name: 'Ayran', amount: '2 su bardaƒüƒ± (400 gr)' },
                    { name: 'Kefir', amount: '1 k√º√ß√ºk bardaƒüƒ± (160 gr)' }
                ]
            },
            'ET': {
                target: 4,
                icon: 'ü•©',
                color: '#e74c3c',
                colorLight: '#ec7063',
                items: [
                    { name: 'K√∂fte', amount: '1 adet (30 gr)' },
                    { name: 'Pirzola (kemiksiz)', amount: '1 adet (30 gr)' },
                    { name: 'Kƒ±yma (pi≈ümi≈ü)', amount: '1 k√∂fte kadar (30 gr)' },
                    { name: 'Ku≈üba≈üƒ± (pi≈ümi≈ü)', amount: '3-4 par√ßa (30 gr)' },
                    { name: 'Biftek (pi≈ümi≈ü)', amount: '1 orta b√ºy√ºkl√ºkte (30 gr)' },
                    { name: 'Balƒ±k (pi≈ümi≈ü)', amount: '1 k√∂fte kadar (45 gr)' },
                    { name: 'Tavuk (pi≈ümi≈ü)', amount: '1 k√∂fte kadar (45 gr)' },
                    { name: 'Beyaz peynir', amount: '2 parmak kadar (30 gr)' },
                    { name: 'Ka≈üar peynir', amount: '¬Ω parmak kadar (20 gr)' },
                    { name: 'Ke√ßi peyniri', amount: '2 parmak kadar (30 gr)' },
                    { name: 'Ezine peyniri', amount: '2 parmak kadar (30 gr)' },
                    { name: 'S√ºzme peynir', amount: '2 parmak kadar (30 gr)' },
                    { name: 'Dil peyniri', amount: '2 parmak kadar (30 gr)' },
                    { name: 'Hellim peyniri', amount: '2 dilim (30 gr)' },
                    { name: '√ñrg√º peyniri', amount: '2 adet (30 gr)' },
                    { name: '√áe√ßil peyniri', amount: '2 parmak kadar (30 gr)' },
                    { name: 'Cheddar peyniri', amount: '1 parmak kadar (20 gr)' },
                    { name: 'Gravyer peyniri', amount: '1 parmak kadar (20 gr)' },
                    { name: 'Krem peyniri', amount: '1 yemek ka≈üƒ±ƒüƒ± (20 gr)' },
                    { name: 'Lor veya √ß√∂kelek', amount: '5-6 yemek ka≈üƒ±ƒüƒ± (30 gr)' },
                    { name: 'Sosis', amount: '1 k√º√ß√ºk adet (30 gr)' },
                    { name: 'Salam', amount: '2 dilim (30 gr)' },
                    { name: 'Yumurta', amount: '1 adet (50 gr)' },
                    { name: 'Yumurta (bƒ±ldƒ±rcƒ±n)', amount: '5 adet (50 gr)' },
                    { name: 'Levrek', amount: '1/5 k√º√ß√ºk boy (55 gr)' },
                    { name: 'Alabalƒ±k', amount: '1/6 orta boy (45 gr)' },
                    { name: '√áipura', amount: '¬º k√º√ß√ºk boy (60 gr)' },
                    { name: 'Somon', amount: '2 parmak boyutunda (40 gr)' },
                    { name: 'ƒ∞stavrit', amount: '4 k√º√ß√ºk boy (60 gr)' },
                    { name: 'Mezgit', amount: '3 orta boy (60 gr)' },
                    { name: 'L√ºfer', amount: '3 yarƒ±m parmak (40 gr)' },
                    { name: 'Sazan', amount: '2 parmak boyutunda (55 gr)' },
                    { name: 'Hamsi', amount: '5 orta boy (45 gr)' },
                    { name: 'Ton balƒ±k', amount: '¬Ω paket (40 gr)' }
                ]
            },
            'EKMEK': {
                target: 3,
                icon: 'üçû',
                color: '#f39c12',
                colorLight: '#f5b041',
                items: [
                    { name: 'Ekmek', amount: '1 dilim (25 gr)' },
                    { name: 'Tuzlu Bisk√ºvi', amount: '2 adet (25 gr)' },
                    { name: 'Galeta', amount: '2-3 adet (25 gr)' },
                    { name: 'Hamburger ekmeƒüi (k√º√ß√ºk)', amount: '¬Ω adet (25 gr)' },
                    { name: 'Sandvi√ß ekmeƒüi (k√º√ß√ºk)', amount: '1/3 adet (25 gr)' },
                    { name: 'Peksimet', amount: '2 adet (25 gr)' },
                    { name: 'Buƒüday Unu (√áorbada)', amount: '1 kase (15 gr)' },
                    { name: 'Tarhana (√áorbada)', amount: '1 kase (15 gr)' },
                    { name: '≈ûehriye (√áorbada)', amount: '1 kase (15 gr)' },
                    { name: 'Pirin√ß (√áorbada)', amount: '1 kase (15 gr)' },
                    { name: 'Mercimek (√áorbada)', amount: '1 kase (15 gr)' },
                    { name: 'Yulaf ezmesi', amount: '2 yemek ka≈üƒ±ƒüƒ± (25 gr)' },
                    { name: 'Pirin√ß pilavƒ±', amount: '2 yemek ka≈üƒ±ƒüƒ± (15 gr)' },
                    { name: 'Bulgur pilavƒ±', amount: '2 yemek ka≈üƒ±ƒüƒ± (15 gr)' },
                    { name: 'Makarna', amount: '2 yemek ka≈üƒ±ƒüƒ± (15 gr)' },
                    { name: 'Kuskus', amount: '2 yemek ka≈üƒ±ƒüƒ± (15 gr)' },
                    { name: 'Eri≈üte', amount: '2 yemek ka≈üƒ±ƒüƒ± (15 gr)' },
                    { name: 'Patates (soƒüumu≈ü)', amount: '1 k√º√ß√ºk boy (90 gr)' },
                    { name: 'Kestane', amount: '2 orta boy (30 gr)' },
                    { name: 'Patlamƒ±≈ü mƒ±sƒ±r (yaƒüsƒ±z)', amount: '1 su bardaƒüƒ± (20 gr)' },
                    { name: 'Beyaz/Sarƒ± Leblebi', amount: '1/2 √ßay bardaƒüƒ± (25 gr)' },
                    { name: 'Etimek', amount: '2 dilim (18 gr)' },
                    { name: 'Grisini', amount: '3 adet (20 gr)' },
                    { name: 'Mƒ±sƒ±r (Taneli)', amount: '2 yemek ka≈üƒ±ƒüƒ± (20 gr)' },
                    { name: 'Mƒ±sƒ±r (Ko√ßan)', amount: '1 k√º√ß√ºk boy (90 gr)' },
                    { name: 'Simit (Susamsƒ±z)', amount: '1/4 adet (30 gr)' },
                    { name: 'Lava≈ü', amount: '1 k√º√ß√ºk boy (30 gr)' },
                    { name: 'Bazlama', amount: '¬º adet (15 gr)' },
                    { name: 'ƒ∞rmik', amount: '2 yemek ka≈üƒ±ƒüƒ± (20 gr)' },
                    { name: 'Tahƒ±l/mƒ±sƒ±r gevreƒüi (sade)', amount: '3 yemek ka≈üƒ±ƒüƒ± (20 gr)' },
                    { name: 'Yufka B√∂reƒüi', amount: '2 parmak kadar (45 gr)' },
                    { name: 'Bezelye', amount: '4 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (100 gr)' },
                    { name: 'Kuru soƒüan', amount: '2 orta boy √ßiƒü (75 gr)' },
                    { name: 'Havu√ß', amount: '1 orta boy pi≈ümi≈ü (100 gr)' },
                    { name: 'Nohut (√ßiƒü)', amount: '3 yemek ka≈üƒ±ƒüƒ± (25 gr)' },
                    { name: 'Kuru fasulye (√ßiƒü)', amount: '3 yemek ka≈üƒ±ƒüƒ± (25 gr)' },
                    { name: 'Barbunya (√ßiƒü)', amount: '3 yemek ka≈üƒ±ƒüƒ± (25 gr)' },
                    { name: 'Mercimek (ye≈üil/kƒ±rmƒ±zƒ±)', amount: '3 yemek ka≈üƒ±ƒüƒ± (25 gr)' },
                    { name: 'Kuru bakla (√ßiƒü)', amount: '3 yemek ka≈üƒ±ƒüƒ± (25 gr)' },
                    { name: 'Kuru b√∂r√ºlce (√ßiƒü)', amount: '3 yemek ka≈üƒ±ƒüƒ± (25 gr)' }
                ]
            },
            'SEBZE': {
                target: 'SINIRSIZ',
                icon: 'ü•¨',
                color: '#27ae60',
                colorLight: '#52be80',
                items: [
                    { name: 'Domates', amount: '1 k√º√ß√ºk boy (100 gr)' },
                    { name: 'Domates suyu', amount: '¬Ω su bardaƒüƒ± (100 gr)' },
                    { name: '√áarliston biber', amount: '4 orta boy (100 gr)' },
                    { name: 'Ye≈üil sivri biber', amount: '10 orta boy (100 gr)' },
                    { name: 'Kƒ±vƒ±rcƒ±k Salata', amount: '15 yaprak (100 gr)' },
                    { name: 'Marul', amount: '5-6 yaprak (100 gr)' },
                    { name: 'Salatalƒ±k', amount: '2 k√º√ß√ºk boy (100 gr)' },
                    { name: 'Kƒ±rmƒ±zƒ± turp', amount: '5 orta boy (100 gr)' },
                    { name: 'Maydanoz', amount: '1 orta demet (75 gr)' },
                    { name: 'Ye≈üil soƒüan', amount: '3-4 orta boy (75 gr)' },
                    { name: 'Kƒ±rmƒ±zƒ± lahana', amount: '1/8 orta boy (100 gr)' },
                    { name: 'Kereviz', amount: '1 k√º√ß√ºk boy (100 gr)' },
                    { name: 'Lahana', amount: '4 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (100 gr)' },
                    { name: 'Karnabahar', amount: '4 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (100 gr)' },
                    { name: 'Taze kabak', amount: '4 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (100 gr)' },
                    { name: 'Patlƒ±can', amount: '4 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (100 gr)' },
                    { name: 'Pazƒ±', amount: '4 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (100 gr)' },
                    { name: 'Ebeg√ºmeci', amount: '4 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (100 gr)' },
                    { name: 'Bamya', amount: '4 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (100 gr)' },
                    { name: 'Taze fasulye', amount: '4 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (100 gr)' },
                    { name: 'Semizotu', amount: '4 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (100 gr)' },
                    { name: 'Ispanak', amount: '4 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (100 gr)' },
                    { name: 'Havu√ß', amount: '1 orta boy √ßiƒü (100 gr)' },
                    { name: 'Havu√ß suyu', amount: '¬Ω su bardaƒüƒ± (120 gr)' },
                    { name: '≈ûalgam', amount: '1 orta boy √ßiƒü (150 gr)' },
                    { name: 'Pƒ±rasa', amount: '5 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (150 gr)' },
                    { name: 'Bakla', amount: '4 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (100 gr)' },
                    { name: 'Enginar', amount: '4 yemek ka≈üƒ±ƒüƒ± pi≈ümi≈ü (100 gr)' },
                    { name: 'Bal kabaƒüƒ±', amount: '3 dilim (100 gr)' }
                ]
            },
            'MEYVE': {
                target: 3,
                icon: 'üçé',
                color: '#9b59b6',
                colorLight: '#bb8fce',
                items: [
                    { name: 'Elma', amount: '1 k√º√ß√ºk boy (100 gr)' },
                    { name: 'Kayƒ±sƒ±', amount: '3 adet (100 gr)' },
                    { name: 'Muz', amount: '1 k√º√ß√ºk boy (50 gr)' },
                    { name: 'Taze incir', amount: '1 adet (80 gr)' },
                    { name: 'Kiraz', amount: '12 adet (75 gr)' },
                    { name: 'Vi≈üne', amount: '14 adet (80 gr)' },
                    { name: 'Greyfurt', amount: '1 k√º√ß√ºk boy (125 gr)' },
                    { name: 'Turun√ß', amount: '1 orta boy (100 gr)' },
                    { name: 'Portakal', amount: '1 orta boy (100 gr)' },
                    { name: 'Limon', amount: '¬Ω orta boy (50 gr)' },
                    { name: 'Mango', amount: '1/3 k√º√ß√ºk boy (120 gr)' },
                    { name: 'Mandalina', amount: '1 b√ºy√ºk boy (100 gr)' },
                    { name: '√úz√ºm', amount: '15 tane (80 gr)' },
                    { name: 'Yaban mersini', amount: '1 su bardaƒüƒ± (150 gr)' },
                    { name: 'Yeni d√ºnya', amount: '6 adet (125 gr)' },
                    { name: 'Erik (ye≈üil)', amount: '7 adet (100 gr)' },
                    { name: 'Erik (m√ºrd√ºm)', amount: '3 orta boy (100 gr)' },
                    { name: 'Karpuz', amount: '3-4 √º√ßgen dilim (150-200 gr)' },
                    { name: '√áilek', amount: '12 adet (175 gr)' },
                    { name: '≈ûeftali', amount: '1 orta boy (100 gr)' },
                    { name: 'B√∂ƒü√ºrtlen/ahududu', amount: '1 √ßay bardaƒüƒ± (100 gr)' },
                    { name: 'Dut', amount: '¬æ su bardaƒüƒ± (115 gr)' },
                    { name: 'Armut', amount: '1 orta boy (100 gr)' },
                    { name: 'Ayva', amount: '¬º orta boy (80 gr)' },
                    { name: 'Nar', amount: '¬Ω k√º√ß√ºk boy (80 gr)' },
                    { name: 'Kavun', amount: '1/8 orta boy (150 gr)' },
                    { name: 'Kuru incir', amount: '1 adet (20 gr)' },
                    { name: 'Kuru kayƒ±sƒ±', amount: '3 adet (20 gr)' },
                    { name: 'Kuru erik', amount: '4 adet (20 gr)' },
                    { name: 'Hurma', amount: '3 adet (15 gr)' },
                    { name: 'Portakal suyu', amount: '1 √ßay bardaƒüƒ± (100 gr)' },
                    { name: 'Greyfurt suyu', amount: '1 √ßay bardaƒüƒ± (100 gr)' },
                    { name: 'Elma suyu', amount: '1 √ßay bardaƒüƒ± (100 gr)' },
                    { name: 'Nar suyu', amount: '1 √ßay bardaƒüƒ± (100 gr)' },
                    { name: '√úz√ºm suyu', amount: '¬º su bardaƒüƒ± (60 gr)' },
                    { name: 'Vi≈üne suyu', amount: '1/3 su bardaƒüƒ± (80 gr)' }
                ]
            },
            'YAƒû': {
                target: 3,
                icon: 'ü´í',
                color: '#e67e22',
                colorLight: '#eb984e',
                items: [
                    { name: 'Zeytin yaƒüƒ±', amount: '1 tatlƒ± ka≈üƒ±ƒüƒ± (5 gr)' },
                    { name: 'Zeytin', amount: '5 adet (20 gr)' },
                    { name: '√áiƒü Fƒ±ndƒ±k', amount: '8 adet (8 gr)' },
                    { name: '√áiƒü Badem', amount: '10 adet (8 gr)' },
                    { name: 'Ceviz', amount: '2 adet (8 gr)' },
                    { name: 'Bitkisel sƒ±vƒ± yaƒü', amount: '1 tatlƒ± ka≈üƒ±ƒüƒ± (5 gr)' },
                    { name: 'Tereyaƒüƒ±', amount: '1 tatlƒ± ka≈üƒ±ƒüƒ± (5 gr)' },
                    { name: 'Avokado', amount: '¬º orta boy (35-40 gr)' },
                    { name: 'Kabak √áekirdeƒüi', amount: '1 yemek ka≈üƒ±ƒüƒ± (10 gr)' },
                    { name: 'Ay √áekirdeƒüi', amount: '1 yemek ka≈üƒ±ƒüƒ± (10 gr)' },
                    { name: 'Kaju fƒ±stƒ±ƒüƒ±', amount: '7 orta boy (10-20 gr)' },
                    { name: 'Yer fƒ±stƒ±ƒüƒ±', amount: '13 orta boy (10-20 gr)' },
                    { name: 'Antep fƒ±stƒ±ƒüƒ±', amount: '12-13 orta boy (10-20 gr)' }
                ]
            },
            '≈ûEKER': {
                target: 1,
                icon: 'üçØ',
                color: '#ff6b9d',
                colorLight: '#ff8fab',
                items: [
                    { name: 'Kesme ≈ûeker', amount: '3 adet (10 gr)' },
                    { name: 'Toz ≈üeker', amount: '1 yemek ka≈üƒ±ƒüƒ± silme (10 gr)' },
                    { name: 'Bal', amount: '1 tatlƒ± ka≈üƒ±ƒüƒ± (10 gr)' },
                    { name: 'Re√ßel', amount: '1 tatlƒ± ka≈üƒ±ƒüƒ± (10 gr)' },
                    { name: 'Marmelat', amount: '1 tatlƒ± ka≈üƒ±ƒüƒ± (10 gr)' },
                    { name: '√úz√ºm pekmezi', amount: '1 tatlƒ± ka≈üƒ±ƒüƒ± (10 gr)' },
                    { name: '√áikolata', amount: '2 k√º√ß√ºk kare (10 gr)' },
                    { name: 'Beyaz √ßikolata', amount: '1 kare (5 gr)' },
                    { name: 'Sade dondurma', amount: '1 top (20 gr)' },
                    { name: 'Tahin helvasƒ±', amount: '2 parmak kadar (8 gr)' }
                ]
            }
        };

        // Komplike yiyecekler listesi (birden fazla gruptan deƒüi≈üim i√ßerir)
        const complexFoods = {
            'ƒ∞mambayƒ±ldƒ± (√ßiƒüden)': {
                portion: '1 adet',
                exchanges: { 'SEBZE': 1, 'YAƒû': 2 }
            },
            'Karnƒ±yarƒ±k (√ßiƒüden)': {
                portion: '1 adet',
                exchanges: { 'SEBZE': 1, 'YAƒû': 1, 'ET': 2 }
            },
            'Etli kabak dolma': {
                portion: '1 adet kabaktan',
                exchanges: { 'SEBZE': 1, 'EKMEK': 1, 'ET': 1, 'YAƒû': 1 }
            },
            'Etli biber dolma': {
                portion: '2 adet',
                exchanges: { 'SEBZE': 1, 'EKMEK': 1, 'ET': 1, 'YAƒû': 1 }
            },
            'Etli yaprak sarma': {
                portion: '8 adet',
                exchanges: { 'SEBZE': 1, 'EKMEK': 2, 'ET': 1, 'YAƒû': 1 }
            },
            'Etli lahana sarma': {
                portion: '4 adet',
                exchanges: { 'SEBZE': 1, 'EKMEK': 1, 'ET': 1, 'YAƒû': 1 }
            },
            'Zeytinyaƒülƒ± biber dolma': {
                portion: '2 adet',
                exchanges: { 'SEBZE': 1, 'EKMEK': 2, 'YAƒû': 2 }
            },
            'Zeytinyaƒülƒ± lahana sarmasƒ±': {
                portion: '4 adet',
                exchanges: { 'SEBZE': 1, 'EKMEK': 1, 'YAƒû': 2 }
            },
            'Zeytinyaƒülƒ± yaprak sarma': {
                portion: '8 adet',
                exchanges: { 'SEBZE': 1, 'EKMEK': 2, 'YAƒû': 2 }
            },
            'Mercimek k√∂ftesi': {
                portion: '2 adet',
                exchanges: { 'EKMEK': 1, 'YAƒû': 1 }
            },
            'Peynirli tepsi b√∂reƒüi': {
                portion: '1 dilim / 2 parmak',
                exchanges: { 'EKMEK': 2, 'ET': 1, 'YAƒû': 1 }
            },
            'G√∂zleme (yarƒ±m yufkadan)': {
                portion: '1 adet',
                exchanges: { 'EKMEK': 4, 'ET': 2, 'YAƒû': 2 }
            },
            'Cheeseburger': {
                portion: '1 adet',
                exchanges: { 'EKMEK': 3, 'ET': 3, 'YAƒû': 1 }
            },
            'Hamburger (mayonezsiz) k√º√ß√ºk': {
                portion: '1 adet',
                exchanges: { 'EKMEK': 2, 'ET': 2 }
            },
            'Hamburger (mayonezsiz) orta': {
                portion: '1 adet',
                exchanges: { 'EKMEK': 3, 'ET': 3 }
            },
            'Pizza (karƒ±≈üƒ±k)': {
                portion: '1 k√º√ß√ºk boy',
                exchanges: { 'ET': 3, 'EKMEK': 5, 'YAƒû': 2 }
            },
            'Lahmacun': {
                portion: '1 adet',
                exchanges: { 'EKMEK': 3, 'ET': 2, 'YAƒû': 2 }
            },
            'Kƒ±ymalƒ± pide': {
                portion: '1 adet',
                exchanges: { 'EKMEK': 4, 'ET': 2, 'YAƒû': 2 }
            },
            'Mantƒ± (yoƒüurtsuz)': {
                portion: '1 k√º√ß√ºk kep√ße',
                exchanges: { 'ET': 1, 'EKMEK': 2, 'YAƒû': 1 }
            },
            'Patates salatasƒ± (soƒüuk)': {
                portion: '5-6 yemek ka≈üƒ±ƒüƒ±',
                exchanges: { 'EKMEK': 1, 'YAƒû': 1 }
            },
            'Kƒ±sƒ±r': {
                portion: '2-3 yemek ka≈üƒ±ƒüƒ±',
                exchanges: { 'EKMEK': 1, 'YAƒû': 1 }
            },
            'Krep': {
                portion: '1 adet',
                exchanges: { 'EKMEK': 1, 'YAƒû': 1 }
            },
            'Poƒüa√ßa (sade)': {
                portion: '1 adet',
                exchanges: { 'EKMEK': 3, 'YAƒû': 2 }
            },
            'Kadƒ±nbudu k√∂fte': {
                portion: '2 adet',
                exchanges: { 'ET': 1, 'EKMEK': 1, 'YAƒû': 4 }
            },
            'ƒ∞√ßli k√∂fte (ha≈ülanmƒ±≈ü)': {
                portion: '1 adet',
                exchanges: { 'ET': 2, 'EKMEK': 1, 'YAƒû': 2 }
            },
            'Sakƒ±zlƒ± muhallebi': {
                portion: '1 kase',
                exchanges: { 'S√úT': 1, 'EKMEK': 1, 'MEYVE': 1 }
            },
            'Madlen √ßikolata': {
                portion: '2 adet',
                exchanges: { 'MEYVE': 1, 'YAƒû': 1 }
            },
            'Ya≈ü pasta (meyveli)': {
                portion: '1 ince dilim',
                exchanges: { 'EKMEK': 2, 'MEYVE': 2, 'YAƒû': 3 }
            },
            'Ya≈ü pasta (√ßikolatalƒ±)': {
                portion: '1 ince dilim',
                exchanges: { 'EKMEK': 2, '≈ûEKER': 2, 'YAƒû': 1 }
            },
            'Kek (sade)': {
                portion: '1 dilim',
                exchanges: { 'EKMEK': 2, 'MEYVE': 1, 'YAƒû': 1 }
            },
            'S√ºtla√ß': {
                portion: '1 kase',
                exchanges: { 'S√úT': 1, 'EKMEK': 1, 'MEYVE': 1 }
            },
            'Cacƒ±k': {
                portion: '1 kase',
                exchanges: { 'S√úT': 1 }
            },
            'A≈üure': {
                portion: '1 kase',
                exchanges: { 'EKMEK': 1, 'MEYVE': 2, 'YAƒû': 1, 'ET': 1 }
            },
            'Ka≈üarlƒ± tost (yaƒüsƒ±z)': {
                portion: '1 adet',
                exchanges: { 'EKMEK': 2, 'ET': 2 }
            },
            'Kƒ±ymalƒ±-Pirin√ßli sebze yemeƒüi': {
                portion: '2 kep√ße',
                exchanges: { 'SEBZE': 1, 'EKMEK': 1, 'ET': 1 }
            },
            'Kurubaklagil yemeƒüi': {
                portion: '2 kep√ße',
                exchanges: { 'ET': 1, 'EKMEK': 1, 'YAƒû': 1 }
            },
            'Sebze yemeƒüi': {
                portion: '2 kep√ße',
                exchanges: { 'YAƒû': 1 }
            }
        };

        // Mevcut tarih
        let currentDate = new Date().toISOString().split('T')[0]; // YYYY-MM-DD format
        let viewingDate = currentDate; // G√∂r√ºnt√ºlenen tarih
        let historyDays = 7; // Varsayƒ±lan ge√ßmi≈ü g√∂r√ºn√ºm

        // Kullanƒ±cƒ± verileri (localStorage'da saklanacak)
        let userData = {
            history: {}, // Tarih bazlƒ± veriler: { 'YYYY-MM-DD': { consumed: {}, complexFoodsConsumed: {} } }
            currentData: { // Bug√ºnk√º veriler (geriye uyumluluk i√ßin)
                consumed: {},
                complexFoodsConsumed: {}
            }
        };

        // Sayfa y√ºklendiƒüinde verileri y√ºkle
        window.onload = function () {
            loadData();
            updateDateDisplay();
            renderFoodGroups();
            renderComplexFoods();
            updateStats();
            renderHistoryTable();
        };

        // Tarihi T√ºrk√ße formatla
        function formatDateTurkish(dateStr) {
            const date = new Date(dateStr + 'T12:00:00');
            const months = ['Ocak', '≈ûubat', 'Mart', 'Nisan', 'Mayƒ±s', 'Haziran',
                'Temmuz', 'Aƒüustos', 'Eyl√ºl', 'Ekim', 'Kasƒ±m', 'Aralƒ±k'];
            const days = ['Pazar', 'Pazartesi', 'Salƒ±', '√áar≈üamba', 'Per≈üembe', 'Cuma', 'Cumartesi'];

            return `${date.getDate()} ${months[date.getMonth()]} ${date.getFullYear()} ${days[date.getDay()]}`;
        }

        // Tarih deƒüi≈ütir
        function changeDate(direction) {
            const date = new Date(viewingDate + 'T12:00:00');
            date.setDate(date.getDate() + direction);
            viewingDate = date.toISOString().split('T')[0];

            // Gelecek tarihe izin verme
            if (viewingDate > currentDate) {
                viewingDate = currentDate;
                showNotification('Gelecek tarihe gidemezsiniz!', 'warning');
                return;
            }

            loadDataForDate();
            updateDateDisplay();
            renderFoodGroups();
            renderComplexFoods();
            updateStats();
        }

        // Bug√ºne git
        function goToToday() {
            viewingDate = currentDate;
            loadDataForDate();
            updateDateDisplay();
            renderFoodGroups();
            renderComplexFoods();
            updateStats();
        }

        // Tarih g√∂stergesini g√ºncelle
        function updateDateDisplay() {
            const dateElement = document.getElementById('currentDate');
            if (viewingDate === currentDate) {
                dateElement.textContent = 'Bug√ºn - ' + formatDateTurkish(viewingDate);
            } else {
                dateElement.textContent = formatDateTurkish(viewingDate);
            }
        }

        // Belirli bir tarih i√ßin veri y√ºkle
        function loadDataForDate() {
            if (userData.history[viewingDate]) {
                userData.currentData = JSON.parse(JSON.stringify(userData.history[viewingDate]));
            } else {
                userData.currentData = {
                    consumed: {},
                    complexFoodsConsumed: {}
                };
            }
        }

        // Mevcut veriyi history'e kaydet
        function saveCurrentToHistory() {
            if (!userData.history) userData.history = {};
            userData.history[viewingDate] = JSON.parse(JSON.stringify(userData.currentData));
        }

        // Tarih i√ßin veri al (read-only)
        function getDataForDate(dateStr) {
            return userData.history[dateStr] || { consumed: {}, complexFoodsConsumed: {} };
        }

        // Besin gruplarƒ±nƒ± render et
        function renderFoodGroups() {
            const container = document.getElementById('foodGroups');
            container.innerHTML = '';

            let delay = 0;
            for (const [groupName, group] of Object.entries(foodGroups)) {
                const groupDiv = document.createElement('div');
                groupDiv.className = 'food-group';
                groupDiv.style.setProperty('--delay', delay);
                groupDiv.style.setProperty('--group-color', group.color);
                groupDiv.style.setProperty('--group-color-light', group.colorLight);

                const consumed = getConsumedCount(groupName);
                const complexConsumed = getComplexGroupCount(groupName);
                const target = group.target === 'SINIRSIZ' ? '‚àû' : group.target;
                const statusClass = getStatusClass(consumed, group.target);
                const statusText = getStatusText(consumed, group.target);
                const progressWidth = getProgressWidth(consumed, group.target);

                let portionText = `${consumed} / ${target}`;
                if (complexConsumed > 0) {
                    portionText += ` <span style="font-size: 0.8rem; opacity: 0.8;">(${complexConsumed} komplike)</span>`;
                }

                groupDiv.innerHTML = `
                    <div class="group-header">
                        <span class="group-icon">${group.icon}</span>
                        <span class="group-title">${groupName} GRUBU</span>
                        <span class="group-status ${statusClass}">${statusText}</span>
                    </div>
                    <div class="portion-info">
                        <span class="portion-text">Hedef Porsiyon</span>
                        <span class="portion-count">${portionText}</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" style="width: ${progressWidth}%"></div>
                    </div>
                    <div class="food-items">
                        ${group.items.map((item, index) => {
                    const quantity = getItemQuantity(groupName, index);
                    const isSelected = quantity > 0;
                    return `
                            <div class="food-item ${isSelected ? 'selected' : ''}">
                                <input type="checkbox" 
                                    class="food-checkbox" 
                                    ${isSelected ? 'checked' : ''}
                                    onchange="toggleFood('${groupName}', ${index})">
                                <span class="food-name">${item.name}</span>
                                <span class="food-amount">${item.amount}</span>
                                <div class="quantity-selector" style="${isSelected ? '' : 'display:none'}">
                                    <button class="quantity-btn" onclick="changeQuantity('${groupName}', ${index}, -1)">-</button>
                                    <span class="quantity-value">${quantity}</span>
                                    <button class="quantity-btn" onclick="changeQuantity('${groupName}', ${index}, 1)">+</button>
                                </div>
                            </div>
                        `}).join('')}
                    </div>
                `;

                container.appendChild(groupDiv);
                delay++;
            }
        }

        // Besin miktarƒ±nƒ± getir
        function getItemQuantity(groupName, itemIndex) {
            if (!userData.currentData.consumed[groupName]) return 0;
            return userData.currentData.consumed[groupName][itemIndex] || 0;
        }

        // Besin se√ßimini deƒüi≈ütir
        function toggleFood(groupName, itemIndex) {
            if (viewingDate !== currentDate) {
                showNotification('Ge√ßmi≈ü tarihleri d√ºzenleyemezsiniz!', 'warning');
                event.target.checked = !event.target.checked;
                return;
            }

            if (!userData.currentData.consumed[groupName]) {
                userData.currentData.consumed[groupName] = {};
            }

            const currentQuantity = userData.currentData.consumed[groupName][itemIndex] || 0;

            if (currentQuantity > 0) {
                // Se√ßimi kaldƒ±r
                delete userData.currentData.consumed[groupName][itemIndex];
            } else {
                // Yeni se√ßim yap, ba≈ülangƒ±√ß miktarƒ± 1
                const group = foodGroups[groupName];
                const currentTotal = getNormalConsumedCount(groupName);

                if (group.target !== 'SINIRSIZ' && currentTotal >= group.target) {
                    showNotification(`${groupName} grubunda hedef porsiyonu doldurdunuz!`, 'warning');
                    // Checkbox'ƒ± geri kapat
                    event.target.checked = false;
                    return;
                }

                userData.currentData.consumed[groupName][itemIndex] = 1;
            }

            saveCurrentToHistory();
            saveData();
            renderFoodGroups();
            updateStats();
            renderHistoryTable();
        }

        // Besin miktarƒ±nƒ± deƒüi≈ütir
        function changeQuantity(groupName, itemIndex, change) {
            event.stopPropagation(); // Checkbox'ƒ±n tetiklenmesini engelle

            if (viewingDate !== currentDate) {
                showNotification('Ge√ßmi≈ü tarihleri d√ºzenleyemezsiniz!', 'warning');
                return;
            }

            if (!userData.currentData.consumed[groupName]) {
                userData.currentData.consumed[groupName] = {};
            }

            const currentQuantity = userData.currentData.consumed[groupName][itemIndex] || 0;
            const newQuantity = currentQuantity + change;

            // Minimum 1, maksimum kontrol
            if (newQuantity < 1) {
                delete userData.currentData.consumed[groupName][itemIndex];
                // Checkbox'ƒ± da kapat
                const checkbox = event.target.closest('.food-item').querySelector('.food-checkbox');
                if (checkbox) checkbox.checked = false;
            } else {
                const group = foodGroups[groupName];
                if (group.target !== 'SINIRSIZ') {
                    const currentTotal = getNormalConsumedCount(groupName);
                    const otherItemsTotal = currentTotal - currentQuantity;

                    if (otherItemsTotal + newQuantity > group.target) {
                        showNotification(`${groupName} grubunda hedef porsiyonu a≈üamazsƒ±nƒ±z!`, 'warning');
                        return;
                    }
                }

                userData.currentData.consumed[groupName][itemIndex] = newQuantity;
            }

            saveCurrentToHistory();
            saveData();
            renderFoodGroups();
            updateStats();
            renderHistoryTable();

            // Grup tamamlandƒ± mƒ± kontrol et
            const newTotal = getNormalConsumedCount(groupName);
            const group = foodGroups[groupName];
            if (group.target !== 'SINIRSIZ' && newTotal === group.target) {
                showNotification(`Tebrikler! ${groupName} grubunu tamamladƒ±nƒ±z! üéâ`, 'success');
            }
        }

        // T√ºketilen porsiyon sayƒ±sƒ±nƒ± getir
        function getConsumedCount(groupName) {
            return userData.consumed[groupName] ? userData.consumed[groupName].length : 0;
        }


        // Durum sƒ±nƒ±fƒ±nƒ± getir
        function getStatusClass(consumed, target) {
            if (target === 'SINIRSIZ') return '';
            if (consumed === 0) return '';
            if (consumed < target) return '';
            if (consumed === target) return 'complete';
            return 'exceed';
        }

        // Durum metnini getir
        function getStatusText(consumed, target) {
            if (target === 'SINIRSIZ') return 'Sƒ±nƒ±rsƒ±z';
            if (consumed === 0) return 'Ba≈ülanmadƒ±';
            if (consumed < target) return 'Devam Ediyor';
            if (consumed === target) return 'Tamamlandƒ± ‚úì';
            return 'A≈üƒ±ldƒ±!';
        }

        // ƒ∞lerleme y√ºzdesini getir
        function getProgressWidth(consumed, target) {
            if (target === 'SINIRSIZ') return 0;
            const percentage = (consumed / target) * 100;
            return Math.min(percentage, 100);
        }

        // ƒ∞statistikleri g√ºncelle
        function updateStats() {
            let totalConsumed = 0;
            let completedGroups = 0;
            let totalTarget = 0;

            // Normal besinleri say
            for (const [groupName, group] of Object.entries(foodGroups)) {
                const consumed = getConsumedCount(groupName);
                totalConsumed += consumed;

                if (group.target !== 'SINIRSIZ') {
                    totalTarget += group.target;
                    if (consumed >= group.target) {
                        completedGroups++;
                    }
                }
            }

            // Komplike yiyecekleri ekle
            const complexConsumed = getComplexFoodsImpact();
            for (const [groupName, count] of Object.entries(complexConsumed)) {
                if (foodGroups[groupName] && foodGroups[groupName].target !== 'SINIRSIZ') {
                    totalConsumed += count;
                }
            }

            const remainingPortions = Math.max(0, totalTarget - totalConsumed);
            const progressPercent = totalTarget > 0 ? Math.round((totalConsumed / totalTarget) * 100) : 0;

            document.getElementById('totalPortions').textContent = totalConsumed;
            document.getElementById('completedGroups').textContent = completedGroups;
            document.getElementById('remainingPortions').textContent = remainingPortions;
            document.getElementById('progressPercent').textContent = progressPercent + '%';
        }

        // Komplike yiyecekleri render et
        function renderComplexFoods() {
            const container = document.getElementById('complexFoods');
            container.innerHTML = '';

            for (const [foodName, foodData] of Object.entries(complexFoods)) {
                const quantity = getComplexFoodQuantity(foodName);
                const isSelected = quantity > 0;

                const foodDiv = document.createElement('div');
                foodDiv.className = `complex-food-item ${isSelected ? 'selected' : ''}`;

                // Deƒüi≈üim badge'lerini olu≈ütur
                let exchangeBadges = '';
                for (const [groupName, count] of Object.entries(foodData.exchanges)) {
                    const group = foodGroups[groupName];
                    if (group) {
                        const totalCount = count * (quantity || 1);
                        exchangeBadges += `
                            <span class="exchange-badge" style="--badge-color: ${group.color}; --badge-color-light: ${group.colorLight}">
                                ${group.icon} ${groupName}
                                <span class="exchange-count">${quantity > 1 ? `${count}√ó${quantity}=${totalCount}` : count}</span>
                            </span>
                        `;
                    }
                }

                foodDiv.innerHTML = `
                    <div class="complex-food-header-row">
                        <input type="checkbox" 
                            class="food-checkbox" 
                            ${isSelected ? 'checked' : ''}
                            onchange="toggleComplexFood('${foodName.replace(/'/g, "\\'")}')">
                        <span class="complex-food-name">${foodName}</span>
                        <span class="complex-food-portion">${foodData.portion}</span>
                    </div>
                    <div class="complex-food-exchanges">
                        ${exchangeBadges}
                    </div>
                    ${isSelected ? `
                        <div class="quantity-selector" style="margin-top: 10px;">
                            <button class="quantity-btn" onclick="changeComplexQuantity('${foodName.replace(/'/g, "\\'")}', -1)">-</button>
                            <span class="quantity-value">${quantity}</span>
                            <button class="quantity-btn" onclick="changeComplexQuantity('${foodName.replace(/'/g, "\\'")}', 1)">+</button>
                        </div>
                    ` : ''}
                `;

                container.appendChild(foodDiv);
            }
        }

        // Komplike yiyecek miktarƒ±nƒ± getir
        function getComplexFoodQuantity(foodName) {
            return userData.complexFoodsConsumed[foodName] || 0;
        }

        // Komplike yiyecek se√ßimini deƒüi≈ütir
        function toggleComplexFood(foodName) {
            if (viewingDate !== currentDate) {
                showNotification('Ge√ßmi≈ü tarihleri d√ºzenleyemezsiniz!', 'warning');
                event.target.checked = !event.target.checked;
                return;
            }

            if (!userData.currentData.complexFoodsConsumed) {
                userData.currentData.complexFoodsConsumed = {};
            }

            const currentQuantity = userData.currentData.complexFoodsConsumed[foodName] || 0;

            if (currentQuantity > 0) {
                // Se√ßimi kaldƒ±r
                delete userData.currentData.complexFoodsConsumed[foodName];
            } else {
                // Yeni se√ßim yap, hedef kontrol√º
                const food = complexFoods[foodName];
                let canAdd = true;
                let warningMessage = '';

                for (const [groupName, count] of Object.entries(food.exchanges)) {
                    const group = foodGroups[groupName];
                    if (group && group.target !== 'SINIRSIZ') {
                        const currentTotal = getConsumedCount(groupName);
                        if (currentTotal + count > group.target) {
                            canAdd = false;
                            warningMessage = `Bu yiyecek ${groupName} grubunda hedefi a≈ümanƒ±za neden olacak!`;
                            break;
                        }
                    }
                }

                if (!canAdd) {
                    showNotification(warningMessage, 'error');
                    event.target.checked = false;
                    return;
                }

                userData.currentData.complexFoodsConsumed[foodName] = 1;
                showNotification(`${foodName} eklendi!`, 'success');
            }

            saveCurrentToHistory();
            saveData();
            renderComplexFoods();
            renderFoodGroups();
            updateStats();
            renderHistoryTable();
        }

        // Komplike yiyecek miktarƒ±nƒ± deƒüi≈ütir
        function changeComplexQuantity(foodName, change) {
            event.stopPropagation();

            if (viewingDate !== currentDate) {
                showNotification('Ge√ßmi≈ü tarihleri d√ºzenleyemezsiniz!', 'warning');
                return;
            }

            if (!userData.currentData.complexFoodsConsumed) {
                userData.currentData.complexFoodsConsumed = {};
            }

            const currentQuantity = userData.currentData.complexFoodsConsumed[foodName] || 0;
            const newQuantity = currentQuantity + change;

            if (newQuantity < 1) {
                delete userData.currentData.complexFoodsConsumed[foodName];
            } else {
                const food = complexFoods[foodName];
                let canAdd = true;
                let warningMessage = '';

                // Her grup i√ßin kontrol
                for (const [groupName, countPerPortion] of Object.entries(food.exchanges)) {
                    const group = foodGroups[groupName];
                    if (group && group.target !== 'SINIRSIZ') {
                        const currentTotal = getConsumedCount(groupName);
                        const currentFromThisFood = currentQuantity * countPerPortion;
                        const newFromThisFood = newQuantity * countPerPortion;
                        const otherFoodsTotal = currentTotal - currentFromThisFood;

                        if (otherFoodsTotal + newFromThisFood > group.target) {
                            canAdd = false;
                            warningMessage = `Bu miktar ${groupName} grubunda hedefi a≈ümanƒ±za neden olacak!`;
                            break;
                        }
                    }
                }

                if (!canAdd) {
                    showNotification(warningMessage, 'error');
                    return;
                }

                userData.currentData.complexFoodsConsumed[foodName] = newQuantity;
            }

            saveCurrentToHistory();
            saveData();
            renderComplexFoods();
            renderFoodGroups();
            updateStats();
            renderHistoryTable();
        }

        // Komplike yiyecek se√ßili mi kontrol et
        function isComplexFoodSelected(foodName) {
            return userData.complexFoodsConsumed && userData.complexFoodsConsumed[foodName] > 0;
        }

        // Komplike yiyeceklerin grup etkisini hesapla
        function getComplexFoodsImpact() {
            const impact = {};

            if (userData.complexFoodsConsumed) {
                for (const [foodName, quantity] of Object.entries(userData.complexFoodsConsumed)) {
                    const food = complexFoods[foodName];
                    if (food) {
                        for (const [groupName, count] of Object.entries(food.exchanges)) {
                            impact[groupName] = (impact[groupName] || 0) + (count * quantity);
                        }
                    }
                }
            }

            return impact;
        }

        // Belirli bir grup i√ßin komplike yiyeceklerden gelen sayƒ±
        function getComplexGroupCount(groupName) {
            const impact = getComplexFoodsImpact();
            return impact[groupName] || 0;
        }

        // T√ºketilen porsiyon sayƒ±sƒ±nƒ± getir (sadece normal besinler)
        function getNormalConsumedCount(groupName) {
            if (!userData.currentData.consumed[groupName]) return 0;
            let total = 0;
            for (const quantity of Object.values(userData.currentData.consumed[groupName])) {
                total += quantity;
            }
            return total;
        }

        // T√ºketilen porsiyon sayƒ±sƒ±nƒ± getir (komplike yiyecekler dahil)
        function getConsumedCount(groupName) {
            const normalCount = getNormalConsumedCount(groupName);
            const complexCount = getComplexGroupCount(groupName);
            return normalCount + complexCount;
        }

        // Bildiri g√∂ster
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;

            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // G√ºnl√ºk sƒ±fƒ±rlama
        function resetDaily() {
            if (viewingDate !== currentDate) {
                showNotification('Sadece bug√ºn√º sƒ±fƒ±rlayabilirsiniz!', 'warning');
                return;
            }

            if (confirm('Bug√ºnk√º takibinizi sƒ±fƒ±rlamak istediƒüinizden emin misiniz?')) {
                userData.currentData = {
                    consumed: {},
                    complexFoodsConsumed: {}
                };
                saveCurrentToHistory();
                saveData();
                renderFoodGroups();
                renderComplexFoods();
                updateStats();
                renderHistoryTable();
                showNotification('Bug√ºnk√º takip sƒ±fƒ±rlandƒ±!', 'success');
            }
        }

        // Ge√ßmi≈ü tablosunu render et
        function renderHistoryTable() {
            const container = document.getElementById('historyTableContainer');
            if (!container) return;

            // Son X g√ºn√º al
            const dates = [];
            const today = new Date(currentDate + 'T12:00:00');
            for (let i = historyDays - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                dates.push(date.toISOString().split('T')[0]);
            }

            // Tablo olu≈ütur
            let tableHTML = `
                <table class="history-table">
                    <thead>
                        <tr>
                            <th>Tarih</th>
                            <th>ü•õ S√ºt</th>
                            <th>ü•© Et</th>
                            <th>üçû Ekmek</th>
                            <th>ü•¨ Sebze</th>
                            <th>üçé Meyve</th>
                            <th>ü´í Yaƒü</th>
                            <th>üçØ ≈ûeker</th>
                            <th>Genel</th>
                        </tr>
                    </thead>
                    <tbody>
            `;

            for (const dateStr of dates) {
                const dayData = getDataForDate(dateStr);
                const isToday = dateStr === currentDate;
                const rowClass = isToday ? 'today-row' : '';

                tableHTML += `<tr class="${rowClass}">`;
                tableHTML += `<td>${formatDateShort(dateStr)}</td>`;

                let totalScore = 0;
                let totalGroups = 0;

                // Her grup i√ßin h√ºcre olu≈ütur
                for (const groupName of ['S√úT', 'ET', 'EKMEK', 'SEBZE', 'MEYVE', 'YAƒû', '≈ûEKER']) {
                    const consumed = calculateGroupTotal(dayData, groupName);
                    const target = foodGroups[groupName].target;

                    if (target === 'SINIRSIZ') {
                        tableHTML += `<td><div class="progress-mini"><div class="progress-mini-fill complete" style="width:100%"></div><span class="progress-mini-text">‚úì</span></div></td>`;
                    } else {
                        const percentage = Math.min((consumed / target) * 100, 100);
                        const fillClass = consumed >= target ? 'complete' : consumed > 0 ? 'partial' : '';
                        const displayText = `${consumed}/${target}`;

                        tableHTML += `
                            <td>
                                <div class="progress-cell">
                                    <div class="progress-mini">
                                        <div class="progress-mini-fill ${fillClass}" style="width:${percentage}%"></div>
                                        <span class="progress-mini-text">${displayText}</span>
                                    </div>
                                </div>
                            </td>
                        `;

                        if (consumed >= target) totalScore++;
                        totalGroups++;
                    }
                }

                // Genel skor
                const scorePercentage = totalGroups > 0 ? Math.round((totalScore / totalGroups) * 100) : 0;
                const scoreClass = scorePercentage >= 80 ? 'perfect' : scorePercentage >= 50 ? 'good' : 'low';
                tableHTML += `<td><span class="total-score ${scoreClass}">${scorePercentage}%</span></td>`;

                tableHTML += `</tr>`;
            }

            tableHTML += `</tbody></table>`;

            if (dates.length === 0) {
                tableHTML = '<div class="no-history">Hen√ºz ge√ßmi≈ü veri bulunmamaktadƒ±r.</div>';
            }

            container.innerHTML = tableHTML;
        }

        // Grup toplamƒ±nƒ± hesapla (normal + komplike)
        function calculateGroupTotal(dayData, groupName) {
            let total = 0;

            // Normal besinler
            if (dayData.consumed && dayData.consumed[groupName]) {
                for (const quantity of Object.values(dayData.consumed[groupName])) {
                    total += quantity;
                }
            }

            // Komplike yiyecekler
            if (dayData.complexFoodsConsumed) {
                for (const [foodName, quantity] of Object.entries(dayData.complexFoodsConsumed)) {
                    const food = complexFoods[foodName];
                    if (food && food.exchanges[groupName]) {
                        total += food.exchanges[groupName] * quantity;
                    }
                }
            }

            return total;
        }

        // Kƒ±sa tarih formatƒ±
        function formatDateShort(dateStr) {
            const date = new Date(dateStr + 'T12:00:00');
            const months = ['Oca', '≈ûub', 'Mar', 'Nis', 'May', 'Haz',
                'Tem', 'Aƒüu', 'Eyl', 'Eki', 'Kas', 'Ara'];

            if (dateStr === currentDate) {
                return `Bug√ºn`;
            }

            return `${date.getDate()} ${months[date.getMonth()]}`;
        }

        // Ge√ßmi≈ü aralƒ±ƒüƒ±nƒ± deƒüi≈ütir
        function changeHistoryRange(days) {
            historyDays = days;

            // Buton stillerini g√ºncelle
            document.querySelectorAll('.range-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');

            renderHistoryTable();
        }

        // Ge√ßmi≈üi Excel'e aktar
        function exportHistory() {
            // CSV formatƒ±nda veri olu≈ütur
            let csv = 'Tarih,S√ºt,Et,Ekmek,Sebze,Meyve,Yaƒü,≈ûeker,Toplam %\n';

            const dates = [];
            const today = new Date(currentDate + 'T12:00:00');
            for (let i = 29; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                dates.push(date.toISOString().split('T')[0]);
            }

            for (const dateStr of dates) {
                const dayData = getDataForDate(dateStr);
                const row = [formatDateTurkish(dateStr)];

                let totalScore = 0;
                let totalGroups = 0;

                for (const groupName of ['S√úT', 'ET', 'EKMEK', 'SEBZE', 'MEYVE', 'YAƒû', '≈ûEKER']) {
                    const consumed = calculateGroupTotal(dayData, groupName);
                    const target = foodGroups[groupName].target;

                    if (target === 'SINIRSIZ') {
                        row.push('Sƒ±nƒ±rsƒ±z');
                    } else {
                        row.push(`${consumed}/${target}`);
                        if (consumed >= target) totalScore++;
                        totalGroups++;
                    }
                }

                const scorePercentage = totalGroups > 0 ? Math.round((totalScore / totalGroups) * 100) : 0;
                row.push(`${scorePercentage}%`);

                csv += row.join(',') + '\n';
            }

            // Download CSV
            const blob = new Blob(['\ufeff' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `diyet_takip_${currentDate}.csv`;
            link.click();

            showNotification('Ge√ßmi≈ü ba≈üarƒ±yla Excel formatƒ±nda indirildi!', 'success');
        }

        // Verileri localStorage'a kaydet
        function saveData() {
            const dataToSave = {
                history: userData.history,
                version: 2 // Veri yapƒ±sƒ± versiyonu
            };
            localStorage.setItem('dietTrackerData', JSON.stringify(dataToSave));
        }

        // Verileri localStorage'dan y√ºkle
        function loadData() {
            const saved = localStorage.getItem('dietTrackerData');
            if (saved) {
                const parsed = JSON.parse(saved);

                // Eski veri yapƒ±sƒ±ndan yeni yapƒ±ya ge√ßi≈ü
                if (!parsed.version || parsed.version < 2) {
                    // Eski veriyi bug√ºne ta≈üƒ±
                    userData.history = {};
                    userData.history[currentDate] = {
                        consumed: parsed.consumed || {},
                        complexFoodsConsumed: parsed.complexFoodsConsumed || []
                    };

                    // Array'i object'e √ßevir (complex foods i√ßin)
                    if (Array.isArray(userData.history[currentDate].complexFoodsConsumed)) {
                        const newComplex = {};
                        for (const foodName of userData.history[currentDate].complexFoodsConsumed) {
                            newComplex[foodName] = 1;
                        }
                        userData.history[currentDate].complexFoodsConsumed = newComplex;
                    }
                } else {
                    userData.history = parsed.history || {};
                }

                // Bug√ºnk√º veriyi y√ºkle
                loadDataForDate();
            } else {
                // ƒ∞lk kullanƒ±m
                userData.history = {};
                userData.currentData = {
                    consumed: {},
                    complexFoodsConsumed: {}
                };
            }
        }
    </script>
</body>

</html>